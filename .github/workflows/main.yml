name: Deploy to GitHub Pages

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Set Secrets as Environment Variables
        run: |
          echo "::set-env name=API_KEY::${{ secrets.API_KEY }}"
          echo "::set-env name=EMAIL_JS::${{ secrets.EMAIL_JS }}"
          echo "::set-env name=SITE_KEY::${{ secrets.SITE_KEY }}"

      - name: Deploy to GitHub Pages
        run: |
          echo "window.secrets = {" >> secrets.js
          echo "  API_KEY: '$API_KEY'," >> secrets.js
          echo "  EMAIL_JS: '$EMAIL_JS'," >> secrets.js
          echo "  SITE_KEY: '$SITE_KEY'" >> secrets.js
          echo "};" >> secrets.js
          cp secrets.js ./dist
        env:
          API_KEY: ${{ secrets.API_KEY }}
          EMAIL_JS: ${{ secrets.EMAIL_JS }}
          SITE_KEY: ${{ secrets.SITE_KEY }}

      - name: Commit Changes
        run: |
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions"
          git add .
          git commit -m "Update secrets.js"
          git push
